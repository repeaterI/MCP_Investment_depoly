<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>MCP Portfolio Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #f5f5f7; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 200px; }
        button { padding: 10px 20px; background: #007aff; color: white; border: none; border-radius: 6px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f0f0f0; padding: 10px; border-radius: 6px; overflow-x: auto; }
        img { max-width: 100%; border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ“ˆ æŠ•èµ„ç»„åˆå¯è§†åŒ–å¤§å±</h1>
        <div>
            <label>User ID: </label>
            <input type="text" id="userId" value="default_user" placeholder="è¾“å…¥ç”¨æˆ·ID">
            <button onclick="loadData()">æŸ¥è¯¢æ•°æ®</button>
        </div>
    </div>

    <div class="card" id="resultArea" style="display:none;">
        <h3>èµ„äº§é…ç½®è¯¦æƒ…</h3>
        <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <h4>JSON æ•°æ®</h4>
                <pre id="jsonData">Loading...</pre>
            </div>
            <div style="flex: 1; text-align: center;">
                <h4>å¯è§†åŒ–å›¾è¡¨</h4>
                <img id="chartImg" src="" alt="Portfolio Chart">
            </div>
        </div>
    </div>

    <script>
        async function loadData() {
            const userId = document.getElementById('userId').value;
            if(!userId) return alert("è¯·è¾“å…¥User ID");
            
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('jsonData').innerText = "Loading...";
            document.getElementById('chartImg').src = ""; // Clear old image

            try {
                // 1. è·å– JSON æ•°æ®
                const res = await fetch(`/api/portfolio/${userId}`);
                const data = await res.json();
                document.getElementById('jsonData').innerText = JSON.stringify(data, null, 2);

                // 2. è·å–å›¾ç‰‡
                // æ·»åŠ æ—¶é—´æˆ³é˜²æ­¢æµè§ˆå™¨ç¼“å­˜
                document.getElementById('chartImg').src = `/api/chart/${userId}?t=${new Date().getTime()}`;
            } catch (e) {
                alert("è·å–æ•°æ®å¤±è´¥ï¼Œè¯·ç¡®ä¿æœåŠ¡å·²å¯åŠ¨ä¸” User ID å­˜åœ¨ã€‚");
                console.error(e);
            }
        }
    </script>
</body>
</html>
